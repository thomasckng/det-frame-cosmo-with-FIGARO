\documentclass[aps,prd,twocolumn,superscriptaddress,preprintnumbers,nofootinbib,hidelinks]{revtex4-2}

\usepackage{showyourwork}
\usepackage{amsfonts,amssymb,amsmath}
\usepackage[nolist,nohyperlinks]{acronym}
\usepackage{bookmark}
\usepackage{orcidlink}
\usepackage{mathtools}

\newcommand{\todo}[1]{\textcolor{red}{[TODO: #1]}}

\begin{document}

\title{Detector-frame cosmology with non-parametric methods}

\author{Thomas~C.~K.~Ng\,\orcidlink{0000-0002-9491-1598}}
\email{thomas.ng@link.cuhk.edu.hk}
\affiliation{Department of Physics, The Chinese University of Hong Kong, Shatin, Hong Kong}

\author{Stefano~Rinaldi\,\orcidlink{0000-0001-5799-4155}}
\email{stefano.rinaldi@uni-heidelberg.de}
\affiliation{Institut~für~Theoretische~Astrophysik, ZAH, Universität~Heidelberg, Albert-Ueberle-Stra{\ss}e~2, 69120 Heidelberg, Germany}
\affiliation{Dipartimento di Fisica e Astronomia ``G. Galilei'', Università di Padova, Via Marzolo 8, 35122 Padova, Italy}

\author{Otto~A.~Hannuksela\,\orcidlink{0000-0002-3887-7137}}
\email{hannuksela@phy.cuhk.edu.hk}
\affiliation{Department of Physics, The Chinese University of Hong Kong, Shatin, Hong Kong}

\begin{abstract}
    The challenge of understanding the Universe's dynamics, particularly the Hubble tension, requires precise measurements of the Hubble constant.
    Building upon the existing spectral siren method, which capitalizes on population information from gravitational wave sources, this study explores an alternative way to analyze the population data to obtain the cosmological parameters in $\Lambda$CDM.
    We will focus on how non-parametric methods, which are flexible models that can be used to agnostically reconstruct arbitrary probability densities, can be incorporated into this framework and leverage the detector-frame mass distribution to infer the cosmological parameters.
    \todo{Rewrite abstract}
\end{abstract}

\maketitle

\begin{acronym}
    \acro{GW}{gravitational wave}
    \acro{LVK}{LIGO-Virgo-KAGRA Collaboration}
    \acro{PE}{parameter estimation}
    \acro{CMB}{cosmic microwave background}
    \acro{EM}{electromagnetic}
    \acro{(H)DPGMM}{hierarchy of Dirichlet process Gaussian mixture model}
    \acro{BBH}{binary black hole}
    \acro{GWTC-3}{the third Gravitational-Wave Transient Catalog}
\end{acronym}

\section{Introduction}
\label{sec:introduction}

% Motivation
In recent years, the precision of cosmological measurements has improved significantly, leading to the discovery of the Hubble tension, a discrepancy between the value of the Hubble constant $H_0$ inferred from the \ac{CMB} \citep{Planck:2018vyg} and local measurements \citep{Riess:2021jrx}.
This tension has motivated the search for new methods to measure $H_0$ with high precision, and \ac{GW} sources have emerged as a promising tool for this purpose.
To infer $H_0$ from \ac{GW} sources, one needs not only the luminosity distance which can be inferred from the signal but also the redshift of the source.
Some \ac{GW} sources can be associated with \ac{EM} counterparts, allowing for the measurement of the redshift, e.g., GW170817 \citep{LIGOScientific:2017adf, Guidorzi:2017ogy}.
However, most \ac{GW} sources do not have \ac{EM} counterparts. \todo{Add galaxy catalog method}
In this case, one can use population statistics to infer $H_0$ by marginalizing the redshift distribution of the sources.
This method is known as the spectral siren \citep{You:2020wju, Mastrogiovanni:2021wsd, LIGOScientific:2021aug, Ezquiaga:2022zkx}.

% Previous work
The fundamental idea of the spectral siren method is to assume a population model for the mass distribution of the sources and marginalize over the redshift distribution to infer the cosmological parameters.
Many studies have explored different variations of the spectral siren method.
\todo{Summarize previous work and add references}

% What's new?
In this study, we explore an alternative method based on the spectral siren framework.
We propose two major modifications to the standard spectral siren method.
First, instead of transforming the individual posterior samples from the detector frame to the source frame during the \ac{PE} process, we transform the population model to the detector frame before performing \ac{PE}.
Second, instead of computing the likelihood of the observed data given the population model, we reconstruct the detector-frame intrinsic population directly from the data using a non-parametric method, where the detector-frame intrinsic population is the detector-frame population after removing the selection effects.

With these modifications, we aim to separate the spectral siren method into two distinct parts.
The first part is the reconstruction of the observed intrinsic population from the data, which does not require any assumptions about the population model, and the intermediate result only depends on the data and the assumption of the selection function.
other assumptions including the population model and cosmological model are then incorporated in the second half.
This separation allows us to explore the impact of different assumptions easily.
The intermediate result of the first part can be reused as long as the data and the assumption on the selection function are the same.
The assumption on the selection function usually does not change in population studies, as the selection function is determined by the detector sensitivity.
\todo{Add references}

% Section outline
In Sec.~\ref{sec:method}, we describe our modified method and the testing procedure.
In Sec.~\ref{sec:results}, we present the results of our method.
In Sec.~\ref{sec:discussion}, we compare our result with other methods and discuss future directions.
Finally, we conclude in Sec.~\ref{sec:conclusion} with a summary.
\todo{Rewrite outline}

\section{Method}
\label{sec:method}

Our method consists of three main steps: the non-parametric reconstruction of the detector-frame intrinsic population, the transformation of the source-frame population model to the detector frame, and the \ac{PE}.
We show the flowchart of our method in Fig.~XXX. \todo{Add flowchart}

\subsection{Non-parametric reconstruction of detector-frame intrinsic population}
\label{sec:reconstruction}

The first step of our method is to reconstruct the detector-frame intrinsic population.
we choose to consider the primary mass $m_1$ of the \ac{BBH} sources, in principle, we can consider more parameters at once.
From the posterior samples obtained from the \ac{PE} of each \ac{GW} event, we reconstruct the detector-frame intrinsic mass distribution $p(m^z_1|\mathbf{d})$, where $\mathbf{d}$ is the observed data of the \ac{GW} events.

To perform the reconstruction, we use a non-parametric reconstruction package \textsc{FIGARO} \citep{Rinaldi:2022kyg}.
Using \textsc{FIGARO}, we perform a \ac{(H)DPGMM} to reconstruct $p(m^z_1|\Xi_i(\mathbf{d}))$ with samples from single-event \ac{PE} posterior $p(m^z_1|d_i)$, where $d_i$ is the observed data of a single \ac{GW} event \citep{Rinaldi:2021bhm}, and $\Xi_i$ is the hyperparameters of the \ac{(H)DPGMM} for a single reconstruction.
In the process of the reconstruction, selection effects are taken into account by \todo{Add equation} \citep{Mandel:2018mve}.

Performing the reconstruction once will give a distribution $p(m^z_1|\Xi_i(\mathbf{d}))$ that is consistent with $\mathbf{d}$ with a given set of hyperparameters $\Xi_i$.
To account for the uncertainty in the reconstruction, we need to perform the reconstruction multiple times to obtain a set of distributions $\{p(m^z_1|\Xi_i(\mathbf{d}))\}$.
The uncertainty of the reconstruction can then be quantified by the spread of the distributions.
In Fig.~XXX \todo{Add figure}, we show an example of the reconstruction obtained with \textsc{FIGARO}.

This part of the method is mostly data-driven and only requires the assumption of the selection function.
Therefore the intermediate result is independent of the population and cosmological model, and we can reuse the result for testing different models.
This reduces the computational cost of the method, as we only need to perform the reconstruction once.

\subsection{Transformation of source-frame population model}
\label{sec:transformation}

On the other hand, we need a source-frame population model $p(m_1|\Lambda)$ to represent the underlying population of the sources, where $\Lambda$ is the population model.
We can either use a parametric model to only assume the form of the population distribution, or we can use a fixed population model to assume the exact population distribution.
With $p(m_1|\Lambda)$, we need to transform it to the detector frame with a given cosmological model to obtain the detector-frame population model $p(m^z_1|\Lambda, \Omega)$, where $\Omega$ is the cosmological model.
In this study, we use the $\Lambda$CDM model with the Planck 2018 cosmological parameters \citep{Planck:2018vyg}, except for $H_0$ which we choose to be a free parameter.
We choose only $H_0$ as a free parameter because the current detection of \ac{GW} sources is local and the effect of $H_0$ dominates other cosmological parameters.
With different $H_0$, $p(m_1|\Lambda)$ will be transformed differently, and the resulting $p(m^z_1|\Lambda, H_0)$ will be different.
By considering a continuous set of $H_{0,j}$ and hyperparameters $\lambda_j$ of the population model, we can obtain a set of $p(m^z_1|\Lambda(\lambda_j), H_{0,j})$, which is a set of continuous detector-frame intrinsic population models for each combination of $H_{0,j}$ and $\Lambda(\lambda_j)$.\footnote{In practice, we use a discrete set of $H_{0,j}$ and $\Lambda(\lambda_j)$ with a small step size to approximate the continuous set.}
In Fig.~XXX \todo{Add figure}, we show an example of the transformation.

Opposite to the first part of the method, this part includes the assumptions about the population and cosmological model.

\subsection{Parameter estimation}
\label{sec:pe}

With $\{p(m^z_1|\Xi_i(\mathbf{d}))\}$ and $\{p(m^z_1|\Lambda_j, H_{0,j})\}$ obtained from Sec.~\ref{sec:reconstruction} and Sec.~\ref{sec:transformation} respectively, we can perform the \ac{PE} to infer the free parameters in the parametric models assumed in Sec.~\ref{sec:transformation}.
The \ac{PE} is performed by comparing $\{p(m^z_1|\Xi_i(\mathbf{d}))\}$ with $\{p(m^z_1|\Lambda_j, H_{0,j})\}$.
To compare the two populations, we use the Jensen–Shannon distance $d_{JS}$ as the distance measure.
$d_{JS}$ is calculated as
\begin{equation}
    d_{JS}(p, q) = \sqrt{\frac{D_{KL}(p||m) + D_{KL}(q||m)}{2}},
\end{equation}
where $p$ and $q$ are the two distributions to be compared, $m = (p + q) / 2$, and $D_{KL}$ is the Kullback–Leibler divergence.
$d_{JS}$ is a symmetric and smoothed version of $D_{KL}$, and it is bounded between 0 and 1.

For each reconstructed distribution $p(m^z_1|\Xi_i(\mathbf{d}))$, we find the best-fit $\Lambda_j$ and $H_{0,j}$ by minimizing $d_{JS}$.
This procedure gives us a set of best-fit $H_{0,i}$ and $\Lambda_i$ for each $\Xi_i$.
Note that the resulting distribution of the best-fit parameters is not a posterior distribution in the Bayesian sense, as we do not consider the likelihood of the observed data given the population model.
Instead, it is a distribution of the best-fit parameters that are consistent with the observed data, distributed according to the uncertainty in the reconstruction of the population.
That is, the uncertainty in the comparison of the two populations is not considered in the resulting distribution.
By considering this optimization procedure only, we can estimate the best-fit parameters without performing computationally expensive likelihood calculations.
In Fig.~XXX \todo{Add figure}, we show an example of the fitting procedure.

\subsection{Minimization of $d_{JS}$}
\label{sec:minimization}

\section{Analysis}
\label{sec:analysis}

\subsection{Injection}
\label{sec:injection-setup}

\subsection{Real data}
\label{sec:real-data-setup}

\section{Results}
\label{sec:results}

\subsection{Injection}
\label{sec:injection-results}

% $H_0$ only

% $H_0$ and $\Lambda$

\subsection{Real data}
\label{sec:real-data-results}

% Power law + peak

% Population model from simulation

\section{Discussion}
\label{sec:discussion}

% Comparison with other methods

% Future directions
    % Likelihood
    % luminosity distance/redshift population 

\section{Conclusion}
\label{sec:conclusion}

\begin{acknowledgments}
T.N.~ and S.R.~ acknowledge financial support from the German Excellence Strategy via the Heidelberg Cluster of Excellence (EXC 2181 - 390900948) STRUCTURES.
S.R.~ acknowledges financial support from the European Research Council for the ERC Consolidator grant DEMOBLACK, under contract no. 770017. 

This research made use of the bwForCluster Helix: the authors acknowledge support by the state of Baden-Württemberg through bwHPC and the German Research Foundation (DFG) through grant INST 35/1597-1 FUGG.

This paper was compiled using \textsc{showyourwork} \cite{Luger2021} to facilitate reproducibility.

\end{acknowledgments}

\bibliography{bib}

\end{document}
